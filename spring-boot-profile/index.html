<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.351cb4de4fb8fafa1978.css" id="gatsby-global-css">code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><meta name="generator" content="Gatsby 2.32.13"/><style data-styled="" data-styled-version="5.3.3">.iwJLgg{-webkit-text-decoration:none;text-decoration:none;color:rgba(0,0,0,0.8);}/*!sc*/
data-styled.g1[id="styled-link__StyledLink-sc-1pzq7s8-0"]{content:"iwJLgg,"}/*!sc*/
.eMJSpf{box-shadow:0 4px 12px 0 rgba(0,0,0,0.05);height:6rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}/*!sc*/
data-styled.g2[id="header__Container-sc-1hjyk8g-0"]{content:"eMJSpf,"}/*!sc*/
.jJfoNH{font-size:1.6rem;font-weight:800;-webkit-letter-spacing:0.1rem;-moz-letter-spacing:0.1rem;-ms-letter-spacing:0.1rem;letter-spacing:0.1rem;text-transform:uppercase;margin:0;}/*!sc*/
@media (max-width:36em){.jJfoNH{text-align:center;}}/*!sc*/
data-styled.g3[id="header__Title-sc-1hjyk8g-1"]{content:"jJfoNH,"}/*!sc*/
@font-face{font-family:system;font-style:normal;font-weight:300;src:local('.SFNSText-Light'),local('.HelveticaNeueDeskInterface-Light'),local('.LucidaGrandeUI'),local('Ubuntu Light'),local('Segoe UI Light'),local('Roboto-Light'),local('DroidSans'),local('Tahoma');}/*!sc*/
:root{font-size:10px;}/*!sc*/
body{font-family:'system';margin:0;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;color:rgba(0,0,0,0.8);min-height:100vh;position:relative;font-size:1.6rem;}/*!sc*/
h1,h2,h3,h4,h5,h6{font-family:sans-serif;}/*!sc*/
h2{font-size:2.5rem;}/*!sc*/
h3{font-size:2.4rem;}/*!sc*/
h4{font-size:1.6rem;}/*!sc*/
code{font-family:Menlo,Monaco,"Courier New",Courier,monospace;word-break:break-word;}/*!sc*/
pre code{word-break:normal;}/*!sc*/
:not(pre) > code[class*="language-"],pre[class*="language-text"]{background-color:transparent;color:inherit;font-size:medium;}/*!sc*/
data-styled.g4[id="sc-global-hvINus1"]{content:"sc-global-hvINus1,"}/*!sc*/
.doySxy{display:block;height:6rem;}/*!sc*/
data-styled.g5[id="layout__Footer-sc-wzore3-0"]{content:"doySxy,"}/*!sc*/
.hYEVc{width:60%;max-width:728px;margin:0 auto;}/*!sc*/
@media (max-width:48em){.hYEVc{width:80%;}}/*!sc*/
data-styled.g6[id="layout__Content-sc-wzore3-1"]{content:"hYEVc,"}/*!sc*/
.gOfPmA{margin-top:8rem;}/*!sc*/
.gOfPmA img{width:100%;}/*!sc*/
@media (max-width:36em){.gOfPmA{margin-top:4rem;}}/*!sc*/
.gOfPmA p{line-height:1.5;}/*!sc*/
.gOfPmA blockquote{margin-left:0.25rem;font-size:1.6rem;color:inherit;font-style:italic;border-left:0.2rem solid rgb(0,0,0);padding-left:1rem;margin:1rem 0;}/*!sc*/
.gOfPmA pre{margin-bottom:2rem;}/*!sc*/
.gOfPmA h3{line-height:1.13;}/*!sc*/
.gOfPmA h2,.gOfPmA h3,.gOfPmA h4,.gOfPmA h5,.gOfPmA h6{margin:2rem 0 2rem;}/*!sc*/
.gOfPmA hr{border:0;border-top:0.1rem solid #ccc;display:block;height:1rem;padding:0;}/*!sc*/
data-styled.g18[id="post-styles__Container-sc-uvw59-0"]{content:"gOfPmA,"}/*!sc*/
@media (max-width:48em){.drQYUS{text-align:center;}}/*!sc*/
data-styled.g19[id="post-styles__Header-sc-uvw59-1"]{content:"drQYUS,"}/*!sc*/
.cCkgzF{margin-bottom:1rem;font-size:3rem;}/*!sc*/
data-styled.g20[id="post-styles__Title-sc-uvw59-2"]{content:"cCkgzF,"}/*!sc*/
.gmHquH{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;list-style:none;padding:0px;}/*!sc*/
data-styled.g21[id="post-styles__LinkList-sc-uvw59-3"]{content:"gmHquH,"}/*!sc*/
.beCzyQ{margin:1rem 0 5rem;}/*!sc*/
.beCzyQ .social-icon{display:inline-block;margin:0 0.5rem;cursor:pointer;}/*!sc*/
data-styled.g22[id="share__Container-sc-1hk3kno-0"]{content:"beCzyQ,"}/*!sc*/
.jiUAsV{font-size:1.4rem;color:rgb(0,0,0);}/*!sc*/
data-styled.g23[id="share___StyledP-sc-1hk3kno-1"]{content:"jiUAsV,"}/*!sc*/
.jyOtij{color:rgba(0,0,0,0.8);}/*!sc*/
data-styled.g24[id="blog-post___StyledSub-sc-1cxuom3-0"]{content:"jyOtij,"}/*!sc*/
.gjclbs{margin:5rem 0;}/*!sc*/
data-styled.g25[id="blog-post___StyledDiv-sc-1cxuom3-1"]{content:"gjclbs,"}/*!sc*/
</style><title data-react-helmet="true">Spring Boot profile 설정하기</title><meta data-react-helmet="true" name="description" content="스프링 부트에서는 properties파일(application.properties)이나 yaml파일(application.yaml)을 사용하여 프로젝트에 원하는 설정들을 적용하거나 수정할 수 있다. 외에도 여러 방법이 있지만(java…"/><meta data-react-helmet="true" property="og:title" content="Spring Boot profile 설정하기"/><meta data-react-helmet="true" property="og:description" content="스프링 부트에서는 properties파일(application.properties)이나 yaml파일(application.yaml)을 사용하여 프로젝트에 원하는 설정들을 적용하거나 수정할 수 있다. 외에도 여러 방법이 있지만(java…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:url" content="https://blog.zooneon.dev"/><meta data-react-helmet="true" property="og:locale" content="ko_KR"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="zooneon"/><meta data-react-helmet="true" name="twitter:title" content="Spring Boot profile 설정하기"/><meta data-react-helmet="true" name="twitter:description" content="스프링 부트에서는 properties파일(application.properties)이나 yaml파일(application.yaml)을 사용하여 프로젝트에 원하는 설정들을 적용하거나 수정할 수 있다. 외에도 여러 방법이 있지만(java…"/><link rel="preconnect dns-prefetch" href="https://www.googletagmanager.com"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="icon" href="/favicon-32x32.png?v=5fa6e614f0c84651b75fe27d99928ac0" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=5fa6e614f0c84651b75fe27d99928ac0"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=5fa6e614f0c84651b75fe27d99928ac0"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=5fa6e614f0c84651b75fe27d99928ac0"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=5fa6e614f0c84651b75fe27d99928ac0"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=5fa6e614f0c84651b75fe27d99928ac0"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=5fa6e614f0c84651b75fe27d99928ac0"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=5fa6e614f0c84651b75fe27d99928ac0"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=5fa6e614f0c84651b75fe27d99928ac0"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/webpack-runtime-302c830d723193e48eb2.js"/><link as="script" rel="preload" href="/framework-45f0bfe9f06e0e8da7d0.js"/><link as="script" rel="preload" href="/styles-bc72ca78f9bad9fb1f45.js"/><link as="script" rel="preload" href="/app-2c7963cebb708efe718f.js"/><link as="script" rel="preload" href="/d5d7a013bc6c1e2b6d7db819052c16d7efea5559-257226443b7dcc72fbb2.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-fe46313b564a949646ae.js"/><link as="fetch" rel="preload" href="/page-data/spring-boot-profile/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3649515864.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/983108779.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><noscript>Sorry! This site requires JavaScript to be enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><nav class="header__Container-sc-1hjyk8g-0 eMJSpf"><a class="styled-link__StyledLink-sc-1pzq7s8-0 iwJLgg" href="/"><h1 class="header__Title-sc-1hjyk8g-1 jJfoNH">zooneon&#x27;s dev log</h1></a></nav><div class="layout__Content-sc-wzore3-1 hYEVc"><article class="post-styles__Container-sc-uvw59-0 gOfPmA"><header class="post-styles__Header-sc-uvw59-1 drQYUS"><h1 class="post-styles__Title-sc-uvw59-2 cCkgzF">Spring Boot profile 설정하기</h1><sub class="blog-post___StyledSub-sc-1cxuom3-0 jyOtij"><span>Posted on <!-- -->April 07, 2022</span><span>  -  </span><span>12 min read</span></sub></header><div class="blog-post___StyledDiv-sc-1cxuom3-1 gjclbs"><p>스프링 부트에서는 properties파일(application.properties)이나 yaml파일(application.yaml)을 사용하여 프로젝트에 원하는 설정들을 적용하거나 수정할 수 있다.</p>
<p>외에도 여러 방법이 있지만(java 코드로 작성하는 방법, 시스템 환경변수를 이용하는 방법 등등) properties파일이나 yaml파일을 이용한 외재화된 설정에 대해 이야기해 보려 한다.</p>
<h2>profile 적용하기</h2>
<p>보통 운영 환경별로 설정들이 달라진다.</p>
<p>사용하는 DB가 다르다던가 로깅 범위 설정, 사용하는 프레임워크의 설정 등등 많은 부분들이 운영 환경에 따라 다르다.</p>
<p>이를 위해 설정 파일들을 운영 환경별로 분리하여 작성할 수 있다.</p>
<div class="gatsby-highlight" data-language="markdown"><pre class="language-markdown"><code class="language-markdown">└── resources
        ├── application.yml
        ├── application-dev.yml
        ├── application-local.yml
        ├── application-prod.yml
        └── application-test.yml</code></pre></div>
<p>간단한 예시를 만들어보았다.</p>
<p>예시로 사용한 스프링 부트 버전은 2.6.6이다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment">#application.yml</span>
<span class="token key atrule">me</span><span class="token punctuation">:</span>
  <span class="token key atrule">nickname</span><span class="token punctuation">:</span> zooneon
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">26</span>
  <span class="token key atrule">github</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/zooneon</code></pre></div>
<p>테스트를 통해 설정이 잘 등록됐는지 확인해보자</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">dev<span class="token punctuation">.</span>zooneon<span class="token punctuation">.</span>profiledemo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">AppConfigTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AppConfig</span> appConfig<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">propertyTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getNickname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">"zooneon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getGithub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">"https://github.com/zooneon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<img width="698" alt="property" src="https://user-images.githubusercontent.com/59433441/162164497-ee217c5f-289d-4346-852b-9903ea5df40c.png">
<p>각각 환경별로 분리된 파일들은 application.yml 파일을 오버라이딩하여 사용한다.</p>
<p>따라서 공통 설정들은 application.yml에 작성한 뒤, 필요하다면 환경별로 설정들을 오버라이드 하면 된다.</p>
<p>원하는 프로파일을 적용하기 위해서는 application.yml 파일에서 적용할 프로파일을 등록하면 된다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment">#application.yml</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> prod
<span class="token key atrule">me</span><span class="token punctuation">:</span>
  <span class="token key atrule">nickname</span><span class="token punctuation">:</span> zooneon
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">26</span>
  <span class="token key atrule">github</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/zooneon</code></pre></div>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment">#application-prod.yml</span>
<span class="token key atrule">me</span><span class="token punctuation">:</span>
  <span class="token key atrule">nickname</span><span class="token punctuation">:</span> zzzooneon
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">100</span></code></pre></div>
<p>잘 오버라이딩 됐는지 결과를 확인해보자</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">dev<span class="token punctuation">.</span>zooneon<span class="token punctuation">.</span>profiledemo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">AppConfigTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AppConfig</span> appConfig<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">overrideTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getNickname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">"zzzooneon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getGithub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">"https://github.com/zooneon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<img width="714" alt="override" src="https://user-images.githubusercontent.com/59433441/162164517-8c8e9204-eea3-4dd8-a7c7-bcbb240a2d5b.png">
<p>jar 파일로 빌드한 뒤 아래와 같은 명령을 통해 파일을 실행시키는 시점에 환경변수를 추가하여 변경할 수도 있다.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ java -jar myapp.jar --spring.profiles.active<span class="token operator">=</span>prod</code></pre></div>
<h2>profile 설정하기</h2>
<h3>마이그레이션</h3>
<p>스프링 부트 2.4 이후로 설정 파일을 작성하는 법이 달라졌다.</p>
<p>만약 스프링 부트 2.4 이전 버전을 사용하고 있다면 다음 명령을 통해 마이그레이션 할 수 있다고 한다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">spring.config.use-legacy-processing</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token comment"># any other properties</span></code></pre></div>
<h3>spring.config.import</h3>
<p>스프링 부트 2.4 이후부터는 <code class="language-text">spring.config.import</code>과 <code class="language-text">spring.config.location</code>을 이용하여 원하는 설정 파일을 불러올 수 있다.</p>
<p>application.yml 파일은 위의 내용과 같다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment">#zooneon.yml</span>
<span class="token key atrule">me</span><span class="token punctuation">:</span>
  <span class="token key atrule">nickname</span><span class="token punctuation">:</span> zooneon
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">26</span>
  <span class="token key atrule">univ</span><span class="token punctuation">:</span> Sejong University
  <span class="token key atrule">major</span><span class="token punctuation">:</span> Computer Engineering</code></pre></div>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment">#application-prod.yml</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">import</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>zooneon.yml</code></pre></div>
<p>제대로 import 되었는지 테스트 해보자</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">dev<span class="token punctuation">.</span>zooneon<span class="token punctuation">.</span>profiledemo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">AppConfigTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AppConfig</span> appConfig<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">importTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getNickname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">"zooneon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getUniv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">"Sejong University"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getMajor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">"Computer Engineering"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<img width="708" alt="import" src="https://user-images.githubusercontent.com/59433441/162164676-d1c5601f-fbf4-4d78-ba3e-7cf1757e5bc6.png">
<p>import는 발견하는 대로 처리하며 import를 선언한 document 아래에 import한 document를 추가한 것처럼 다룬다.</p>
<p>또한 import한 프로파일에 있는 값은 import를 트리거 한 파일보다 우선시되어 오버라이드 할 수 있다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment">#application-prod.yml</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">import</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>zooneon.yml
<span class="token comment">#이 값은 오버라이드 될 것이다.</span>
<span class="token key atrule">me</span><span class="token punctuation">:</span>
  <span class="token key atrule">nickname</span><span class="token punctuation">:</span> junwon</code></pre></div>
<p>여러 개의 파일을 import 할 수 있는데, 이 경우 뒤에 있는 파일이 우선권을 갖는다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment">#application-prod.yml</span>
<span class="token comment">#test.yml이 우선권을 갖는다.</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">import</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>zooneon.yml<span class="token punctuation">,</span>classpath<span class="token punctuation">:</span>test.yml</code></pre></div>
<p><code class="language-text">optional</code> 키워드를 사용하여 설정 파일이 존재하지 않아도 어플리케이션이 실행될 수 있도록 할 수 있다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment">#application-prod.yml</span>
<span class="token comment">#nonexistent.yml 파일이 존재하지 않아도 어플리케이션은 실행된다.</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">import</span><span class="token punctuation">:</span> optional<span class="token punctuation">:</span>classpath<span class="token punctuation">:</span>nonexistent.yml</code></pre></div>
<h3>Multi-Document File</h3>
<p>스프링 부트에서는 물리적인 파일 하나를 각각 독립적으로 추가되는 여러 개의 논리적 document로 분리할 수 있다.</p>
<p>document는 위에서 아래 순으로 처리되기 때문에 뒤에 있는 document는 앞에 있는 document를 오버라이드 할 수 있다.</p>
<p>yaml파일에서는 구분자(<code class="language-text">---</code>)로 구분할 수 있다.(스프링 부트 2.4부터 properties파일도 <code class="language-text">#---</code>를 이용할 수 있다.)</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment">#application-prod.yml</span>
<span class="token key atrule">me</span><span class="token punctuation">:</span>
  <span class="token key atrule">nickname</span><span class="token punctuation">:</span> zzzooneon
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">100</span>

<span class="token punctuation">---</span>
<span class="token key atrule">me</span><span class="token punctuation">:</span>
  <span class="token key atrule">nickname</span><span class="token punctuation">:</span> junwon
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">200</span></code></pre></div>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">dev<span class="token punctuation">.</span>zooneon<span class="token punctuation">.</span>profiledemo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">AppConfigTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AppConfig</span> appConfig<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">separatorTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getNickname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">"junwon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getGithub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">"https://github.com/zooneon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>그럼 프로파일별로 다른 설정값을 사용해야 할 때는 어떻게 정의할까?</p>
<p>그럴 때는 <code class="language-text">spring.config.activate.on-profile</code> 속성을 사용하면 된다.</p>
<p>위에서 말했듯이 multi document에서 document는 위에서 아래로 처리되기 때문에 activate.on-profile 속성이 없으면 제일 마지막 설정값이 적용된다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment">#zooneon.yml</span>
<span class="token key atrule">me</span><span class="token punctuation">:</span>
  <span class="token key atrule">nickname</span><span class="token punctuation">:</span> zooneon
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">26</span>
  <span class="token key atrule">univ</span><span class="token punctuation">:</span> Sejong University
  <span class="token key atrule">major</span><span class="token punctuation">:</span> Computer Engineering

<span class="token punctuation">---</span>
<span class="token key atrule">spring.config.activate.on-profile</span><span class="token punctuation">:</span> test
<span class="token key atrule">me</span><span class="token punctuation">:</span>
  <span class="token key atrule">nickname</span><span class="token punctuation">:</span> zzzooneon
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">19</span>
  <span class="token key atrule">univ</span><span class="token punctuation">:</span> Not attending
  <span class="token key atrule">major</span><span class="token punctuation">:</span> None

<span class="token punctuation">---</span>
<span class="token key atrule">spring.config.activate.on-profile</span><span class="token punctuation">:</span> prod
<span class="token key atrule">me</span><span class="token punctuation">:</span>
  <span class="token key atrule">nickname</span><span class="token punctuation">:</span> junwon
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">27</span>
  <span class="token key atrule">univ</span><span class="token punctuation">:</span> Graduate
  <span class="token key atrule">major</span><span class="token punctuation">:</span> Computer Engineering</code></pre></div>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment">#application.yml</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> test
<span class="token key atrule">me</span><span class="token punctuation">:</span>
  <span class="token key atrule">nickname</span><span class="token punctuation">:</span> zooneon
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">26</span>
  <span class="token key atrule">github</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/zooneon</code></pre></div>
<p>설정값이 제대로 등록되었는지 확인해보자</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">dev<span class="token punctuation">.</span>zooneon<span class="token punctuation">.</span>profiledemo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">AppConfigTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AppConfig</span> appConfig<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">multiDocumentTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getNickname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">"zzzooneon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getUniv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">"Not attending"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getMajor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">"None"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p><img src="https://user-images.githubusercontent.com/59433441/162164717-b3909f71-a1b8-4c64-b318-d5e91500274c.png" alt="multi document"></p>
<p>스프링 부트 2.4 이전에는 <code class="language-text">spring.profiles</code> 을 이용하여 각 프로파일에서 사용할 설정값들을 작성하였는데 이는 deprecated 되었다.</p>
<p>그렇기 때문에 이제 <code class="language-text">spring.config.activate.on-profile</code>을 이용하자</p>
<p><img src="https://user-images.githubusercontent.com/59433441/162164738-07b34893-a4c3-4409-bc6a-4b647462d6bd.png" alt="deprecated"></p>
<p>하지만 여기서 알아둘 것이 하나 있다.</p>
<p>스프링 부트 2.4 이전 사용자들은 아마 <code class="language-text">spring.profiles</code>로 적용할 프로파일을 설정하고 <code class="language-text">spring.profiles.include</code>를 사용하여 원하는 프로파일을 불러와서 사용했을 것이다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment">#application.yml</span>
<span class="token comment">#legacy mode 사용</span>
<span class="token key atrule">spring.config.use-legacy-processing</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> prod

<span class="token punctuation">---</span>
<span class="token key atrule">spring.profiles</span><span class="token punctuation">:</span> prod
<span class="token key atrule">spring.profiles.include</span><span class="token punctuation">:</span> database
<span class="token key atrule">me</span><span class="token punctuation">:</span>
  <span class="token key atrule">nickname</span><span class="token punctuation">:</span> junwon
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">26</span></code></pre></div>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment">#application-database.yml</span>
<span class="token key atrule">db</span><span class="token punctuation">:</span>
  <span class="token key atrule">username</span><span class="token punctuation">:</span> root
  <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">1234</span></code></pre></div>
<p>스프링 부트 2.4 이후부터는 <code class="language-text">spring.config.activate.on-profile</code>을 사용한 document에서 <code class="language-text">spring.profiles.include</code>를 사용할 수 없다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment">#application.yml</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> test2

<span class="token punctuation">---</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">activate</span><span class="token punctuation">:</span>
      <span class="token key atrule">on-profile</span><span class="token punctuation">:</span> test2
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">include</span><span class="token punctuation">:</span> database<span class="token punctuation">,</span> test</code></pre></div>
<p>이렇게 설정하면 <code class="language-text">InactiveConfigDataAccessException</code> 예외가 발생하게 된다.</p>
<img width="954" alt="include with on profile property" src="https://user-images.githubusercontent.com/59433441/162164786-37fc1969-7cce-4c7f-b1b0-bc321fe2f05e.png">
<p>따라서 include를 사용하기 위해서는 on-profile 속성과 다른 document에서 사용해야 한다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment">#application.yml</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> test2
    <span class="token key atrule">include</span><span class="token punctuation">:</span> database
<span class="token key atrule">me</span><span class="token punctuation">:</span>
  <span class="token key atrule">nickname</span><span class="token punctuation">:</span> zooneon
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">26</span>
  <span class="token key atrule">github</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/zooneon

<span class="token punctuation">---</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">activate</span><span class="token punctuation">:</span>
      <span class="token key atrule">on-profile</span><span class="token punctuation">:</span> test2
<span class="token key atrule">me</span><span class="token punctuation">:</span>
  <span class="token key atrule">nickname</span><span class="token punctuation">:</span> zzzooneon
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">50</span></code></pre></div>
<p>테스트를 하다가 알게 된 사실인데 include를 하게 되면 하단 document에서 오버라이드한 속성을 무시하는 것 같다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment">#application.yml</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> test2
    <span class="token key atrule">include</span><span class="token punctuation">:</span> database
<span class="token key atrule">me</span><span class="token punctuation">:</span>
  <span class="token key atrule">nickname</span><span class="token punctuation">:</span> zooneon
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">26</span>
  <span class="token key atrule">github</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/zooneon

<span class="token punctuation">---</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">activate</span><span class="token punctuation">:</span>
      <span class="token key atrule">on-profile</span><span class="token punctuation">:</span> test2
<span class="token key atrule">me</span><span class="token punctuation">:</span>
  <span class="token key atrule">nickname</span><span class="token punctuation">:</span> zzzooneon
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">50</span>
<span class="token key atrule">db</span><span class="token punctuation">:</span>
  <span class="token key atrule">username</span><span class="token punctuation">:</span> test2<span class="token punctuation">-</span>user
  <span class="token key atrule">password</span><span class="token punctuation">:</span> test2<span class="token punctuation">-</span>user</code></pre></div>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment">#application-database.yml</span>
<span class="token key atrule">db</span><span class="token punctuation">:</span>
  <span class="token key atrule">username</span><span class="token punctuation">:</span> root
  <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">1234</span></code></pre></div>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">dev<span class="token punctuation">.</span>zooneon<span class="token punctuation">.</span>profiledemo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">AppConfigTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AppConfig</span> appConfig<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">includeIgnoreOverrideTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getNickname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">"zzzooneon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getDbUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getDbPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">"1234"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>application.yml 파일에서 볼 수 있듯이 test2 프로파일에서 me와 db 속성을 오버라이드 하였다.</p>
<p>테스트코드를 보면 me 속성은 오버라이드 한 결과로 나왔지만 include한 db 속성의 경우 오버라이드 한 값이 아닌 include 한 값이 저장된다.</p>
<p>테스트는 통과한다.</p>
<img width="700" alt="include ignore override" src="https://user-images.githubusercontent.com/59433441/162164821-c86b5026-4de9-46a6-9f64-b22eafd8ab4f.png">
<p>혹시 선언 순서 때문에 그런가 해서 active와 include의 순서를 바꿔보았는데도 결과는 같았다.</p>
<p>include도 import처럼 트리거 한 파일보다 우선시되는 것 같다.</p>
<h3>spring.profiles.group</h3>
<p>스프링 부트 2.4부터는 <code class="language-text">spring.profiles.group</code> 속성을 통해 원하는 프로파일을 grouping 할 수 있다.</p>
<p>예를 들어 환경별로 사용해야 하는 프로파일이 다를 경우 필요한 프로파일을 group에 추가하여 사용할 수 있다.</p>
<p>zooneon.yml 파일의 내용은 위와 같다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment">#application.yml</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> prod
    <span class="token key atrule">group</span><span class="token punctuation">:</span>
      <span class="token key atrule">prod</span><span class="token punctuation">:</span> zooneon<span class="token punctuation">,</span> prod<span class="token punctuation">-</span>db
      <span class="token key atrule">test</span><span class="token punctuation">:</span> zooneon<span class="token punctuation">,</span> test<span class="token punctuation">-</span>db
<span class="token key atrule">me</span><span class="token punctuation">:</span>
  <span class="token key atrule">nickname</span><span class="token punctuation">:</span> zooneon
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">26</span>
  <span class="token key atrule">github</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/zooneon

<span class="token punctuation">---</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">activate</span><span class="token punctuation">:</span>
      <span class="token key atrule">on-profile</span><span class="token punctuation">:</span> prod<span class="token punctuation">-</span>db
<span class="token key atrule">db</span><span class="token punctuation">:</span>
  <span class="token key atrule">username</span><span class="token punctuation">:</span> prod<span class="token punctuation">-</span>user
  <span class="token key atrule">password</span><span class="token punctuation">:</span> qwerty<span class="token tag">!@</span>

<span class="token punctuation">---</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">activate</span><span class="token punctuation">:</span>
      <span class="token key atrule">on-profile</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>db
<span class="token key atrule">db</span><span class="token punctuation">:</span>
  <span class="token key atrule">username</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>user
  <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">1234</span></code></pre></div>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">dev<span class="token punctuation">.</span>zooneon<span class="token punctuation">.</span>profiledemo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">AppConfigTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AppConfig</span> appConfig<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">groupTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getNickname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">"junwon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">27</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getDbUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">"prod-user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>appConfig<span class="token punctuation">.</span><span class="token function">getDbPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">"qwerty!@"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>맨 상단에 group을 선언하여 prod에서는 zooneon, prod-db 프로파일을 사용하고 test에서는 zooneon, test-db 프로파일을 사용하도록 하였다.</p>
<p>테스트 결과를 보면 active를 prod로 선언하였기 때문에 zooneon, prod-db 프로파일이 사용된 것을 확인할 수 있다.</p>
<p>zooneon 프로파일에서는 <code class="language-text">on-active: prod</code>로 오버라이드한 값이 사용되었다.</p>
<p>group 속성도 include와 마찬가지로 on-profile 속성을 사용한 document와 함께 사용하면 <code class="language-text">InactiveConfigDataAccessException</code> 예외가 발생한다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">group</span><span class="token punctuation">:</span>
      <span class="token key atrule">prod</span><span class="token punctuation">:</span> zooneon<span class="token punctuation">,</span> prod<span class="token punctuation">-</span>db
      <span class="token key atrule">test</span><span class="token punctuation">:</span> zooneon<span class="token punctuation">,</span> test<span class="token punctuation">-</span>db
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">activate</span><span class="token punctuation">:</span>
      <span class="token key atrule">on-profile</span><span class="token punctuation">:</span> test2</code></pre></div>
<img width="953" alt="group with on-profile property" src="https://user-images.githubusercontent.com/59433441/162164848-3ceb1665-4491-4229-a62c-296e2fea26d9.png">
<h2>마무리</h2>
<p>스프링 부트 2.4 이후의 프로파일 설정하는 방법을 간단하게 알아보았다.</p>
<p>2.4 이전 버전과 많이 달라졌다고 하는데 사실 2.4 이전 버전을 사용해 보지 않아서 차이가 확 와닿지는 않는 것 같다.</p>
<p>사실 지금까지 했던 프로젝트들도 모두 간단한 프로젝트이고 설정들도 복잡하지 않았기 때문에 잘 모르고 사용했던 것 같다.</p>
<p>찾아보니 생각보다 많은 기능이 있었고, 이를 활용하면 재사용성도 높아지고 더 깔끔하게 관리할 수 있을 것 같다는 생각이 들었다.</p>
<hr>
<h3>참고</h3>
<ul>
<li><a href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-Config-Data-Migration-Guide#multi-document-yaml-ordering">https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-Config-Data-Migration-Guide#multi-document-yaml-ordering</a></li>
</ul></div><ul class="post-styles__LinkList-sc-uvw59-3 gmHquH"><li><a rel="prev" class="styled-link__StyledLink-sc-1pzq7s8-0 iwJLgg" href="/use-objectmapper-to-parse-json/">← <!-- -->ObjectMapper를 이용하여 JSON 파싱하기</a></li><li><a rel="next" class="styled-link__StyledLink-sc-1pzq7s8-0 iwJLgg" href="/aws-codedeploy-environment-variables/">AWS CodeDeploy를 이용한 자동 배포 시 환경변수 주입하기 + Spring Boot<!-- --> →</a></li></ul><div class="comments-wrapper"><div>Loading script...</div><div></div></div><div class="share__Container-sc-1hk3kno-0 beCzyQ"><p class="share___StyledP-sc-1hk3kno-1 jiUAsV">Share if you liked it:</p></div></article></div><footer class="layout__Footer-sc-wzore3-0 doySxy"></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-PB788GF0S1"></script><script>
        
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
        </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/spring-boot-profile/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-ed717a4fd71e6ab9d4db.js"],"app":["/app-2c7963cebb708efe718f.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-16703ee5599528db9f93.js"],"component---src-pages-404-js":["/component---src-pages-404-js-9ead8f60164dc266ad59.js"],"component---src-pages-index-js":["/component---src-pages-index-js-911b6742c5b371483563.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-fe46313b564a949646ae.js"]};/*]]>*/</script><script src="/polyfill-ed717a4fd71e6ab9d4db.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-fe46313b564a949646ae.js" async=""></script><script src="/d5d7a013bc6c1e2b6d7db819052c16d7efea5559-257226443b7dcc72fbb2.js" async=""></script><script src="/app-2c7963cebb708efe718f.js" async=""></script><script src="/styles-bc72ca78f9bad9fb1f45.js" async=""></script><script src="/framework-45f0bfe9f06e0e8da7d0.js" async=""></script><script src="/webpack-runtime-302c830d723193e48eb2.js" async=""></script></body></html>